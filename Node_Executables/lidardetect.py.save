#!/usr/bin/env python

import rospy
import math
from std_msgs.msg import Float64
from vesc_msgs.msg import VescStateStamped
from sensor_msgs.msg import LaserScan

global pub1
global pub3
global pub2

def callback(data):
    global pub1
    global pub2
    global pub3
    front_left =(data.ranges[0:10])
    front_right=(data.ranges[-10:])
    front = front_right+front_left
#    for i in range(len(front)): 
#        if(front[i]==float('inf')):
#             front[i]=data.ranges[(i-5+1)]/2+data.ranges[(i-5-1)]/2
#    avg = sum(front)/10
    Min=min(front)
    if(Min>1.0):
        verd=""
        print verd
        pub1.publish(2500.0)
        pub3.publish(0.48)
    else:
        verd="near"
        brake()

def brake():
    rospy.Subscriber("/sensors/core",VescStateStamped ,getspeed)
    rospy.spin() 

def getspeed(data):
   global pub2
   global pub1
#   rospy.loginfo(data.state.current_motor)
   pub1.publish(0.0)

def lidardetect():
    global pub1
    global pub2
    global pub3
    rospy.init_node("LidarDetect", anonymous=True)
    rospy.Subscriber("/scan", LaserScan, callback)
    pub1 = rospy.Publisher("commands/motor/speed", Float64, queue_size=10)
    pub2 = rospy.Publisher("commands/motor/brake", Float64, queue_size=10)
    pub3 = rospy.Publisher("commands/servo/position",Float64, queue_size=10)
    rospy.spin()

if __name__ == '__main__':
    lidardetect()
